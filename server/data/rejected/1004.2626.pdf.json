{
  "name" : "1004.2626.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Propagating Conjunctions of ALLDIFFERENT Constraints",
    "authors" : [ "Christian Bessiere", "George Katsirelos", "Nina Narodytska", "Claude-Guy Quimper", "Toby Walsh" ],
    "emails" : [ "bessiere@lirmm.fr", "gkatsi@gmail.com", "ninan@cse.unsw.edu.au", "cquimper@gmail.com", "toby.walsh@nicta.com.au" ],
    "sections" : [ {
      "heading" : "Introduction",
      "text" : "Global constraints are a critical factor in the success of constraint programming. They capture patterns that often occur in practice (e.g. “these courses must occur at different times”). In addition, fast propagation algorithms are associated with each global constraint to reason about potential solutions (e.g. “these 4 courses have only 3 time slots between them so, by a pigeonhole argument, the problem is infeasible”). One of the oldest and most useful global constraints is the ALLDIFFERENT constraint (Laurière 1978). This specifies that a set of variables takes all different values. Many different algorithms have been proposed for propagating the ALLDIFFERENT constraint (Régin 1994; Leconte 1996; Puget 1998). Such propagators can have a significant impact on our ability to solve problems (Stergiou & Walsh 1999).\nProblems often contain multiple ALLDIFFERENT constraints (e.g. “The CS courses must occur at different times, as must the IT courses. In addition, CS and IT have several courses in common”). Currently, constraint solvers ignore information about the overlap between multiple constraints (except for the limited communication provided by the domains of common variables). Here, we show the benefits of reasoning about such overlap. This is a challenging problem\nCopyright c© 2013, Association for the Advancement of Artificial Intelligence (www.aaai.org). All rights reserved.\nas finding a solution to just two ALLDIFFERENT constraints is NP-hard (Kutz et al. 2008) and existing approaches to deal with such overlaps require exponential space (Lardeux et al. 2008). Our approach is to focus on domains that are ordered, as often occurs in practice. For example in our time-tabling problem, values might represent times (which are naturally ordered). In such cases, domains can be compactly represented by intervals. Propagation algorithms can narrow such intervals using the notion of bound consistency. Our main result is to prove we can enforce bound consistency on two ALLDIFFERENT constraints in polynomial time. Our algorithm exploits a connection with matching on bipartite graphs. In particular, we consider simultaneous matchings. By generalizing Hall’s theorem, we identify a necessary and sufficient condition for the existence of such a matching and show that the this problem is polynomial for convex graphs."
    }, {
      "heading" : "Formal background",
      "text" : "Constraint programming. We use capitals for variables and lower case for values. Values range over 1 to d. We write D(X) for the domain of values for X , lb(X) (ub(X)) for the smallest (greatest) value in D(X). A global constraint is one in which the number of variables n is a parameter. For instance, ALLDIFFERENT([X1, . . . , Xn]) ensures that Xi 6= Xj for any i < j. Constraint solvers prune search by enforcing properties like domain consistency. A constraint is domain consistent (DC) iff when a variable is assigned any value in its domain, there are compatible values in the domains of all other variables. Such an assignment is a support. A constraint is bound consistent (BC) iff when a variable is assigned the minimum or maximum value in its domain, there are compatible values between the minimum and maximum domain value for all other variables. Such an assignment is a bound support. A constraint is bound disentailed iff no possible assignment is a bound support. Graph Theory. Solutions of ALLDIFFERENT correspond to matchings in a bipartite variable/value graph (Régin 1994).\nDefinition 1. The graph G = 〈V,E〉 is bipartite if V partitions into 2 classes, V = A ∪ B and A ∩ B = ∅, such that every edge has ends in different classes.\nDefinition 2. Let G = 〈A ∪B,E〉 be a bipartite graph. A matching that covers A is a set of pairwise non-adjacent edges M ⊆ E such that every vertex from A is incident to\nar X\niv :1\n00 4.\n26 26\nv1 [\ncs .A\nI] 1\n5 A\npr 2\n01 0\nexactly one edge from M . We will consider simultaneous matchings on bipartite graphs(SIM-BM) (Kutz et al. 2008). Definition 3. An overlapping bipartite graph is a bipartite graph G = 〈A ∪B,E〉 and two sets S and T such that A = S ∪ T , A ∩B = ∅, and S ∩ T 6= ∅. Definition 4. Let 〈A ∪B,E〉 and S, T be an overlapping bipartite graph. A simultaneous matching is a set of edges M ⊆ E such that M ∩ (S × B) and M ∩ (T × B) are matchings that cover S and T , respectively.\nIn the following, we use the convention that a set of vertices P is a subset of the partition A. We write N(P ) for the neighborhood of P , PS = P ∩ (S \\ T ), PT = P ∩ (T \\ S) and PST = P ∩ S ∩ T . SIM-BM problems frequently occur in real world applications like production scheduling and timetabling. We introduce here a simple exam timetabling problem that will serve as a running example. Running example. We have 7 exams offered over 5 days and 2 students. The first student has to take the first 5 exams and the second student has to take the last 5 exams. Due to the availability of examiners, not every exam is offered each day. For example, the first exam cannot be on the last day of the week. Only one exam can be sat each day. This problem can be encoded as a SIM-BM problem. A represents the exams and contains 7 vertices X1 to X7. B represents the days and contains the vertices 1 to 5. S = [X1, X2, X3, X4, X5] and T = [X3, X4, X5, X6, X7]. We connect vertices between A and B to encode the availability restrictions of the examiners. The adjacency matrix of the graph is as follows:\n1 2 3 4 5\nAS = S \\ T X1 ∗ ∗ ∗ ∗ X2 ∗ ∗\nAST = S ∩ T X3 ∗ ∗ ∗ X4 ∗ ∗ ∗ X5 ∗ ∗ ∗ ∗ ∗\nAT = T \\ S X6 ∗ ∗ X7 ∗ ∗ ∗ ∗\nFinding a solution for this SIM-BM problem is equivalent to solving the timetabling problem."
    }, {
      "heading" : "Simultaneous Bipartite Matching",
      "text" : "We now consider how to find a simultaneous matching. Unfortunately, this problem is NP-complete in general (Kutz et al. 2008). Our contribution here is to identify a necessary and sufficient condition for the existence of a simultaneous matching based on an extension of Hall’s theorem (Hall 1935). We use this to show that a simultaneous matching on a convex bipartite graph can be found in polynomial time.\nIn the following, let G′(u,v) be the subgraph of the overlapping bipartite graph G that is induced by choosing an edge (u, v) to be in the simultaneous matching. If u ∈ AST then G′(u,v) = G − {u, v}. If u ∈ A\nS (and symmetrically if u ∈ AT ) then G′(u,v) = 〈V − {u}, E \\ {(u\n′, v)|u′ ∈ S}〉. If M is a SIM-BM in G′(u,v), then M∪{(u, v)} is a SIM-BM in G. Since the edge (u, v) is implied throughout, we write G′ = G′(u,v). In addition, we write N ′(P ) = NG′(P )."
    }, {
      "heading" : "Extension of Hall’s Theorem",
      "text" : "Hall’s theorem provides a necessary and sufficient condition for the existence of a perfect matching in a bipartite graph. Theorem 1 (Hall Condition (Hall 1935)). Let G = 〈A ∪B,E〉 such that A ∩ B = ∅. There exists a perfect matching iff |N(P )| ≥ |P | for P ⊆ A.\nInterestingly we only need a small adjustment for simultaneous matching. Theorem 2 (Simultaneous Hall Condition (SIM-HC)). Let G = 〈A ∪B,E〉 and sets S, T be an overlapping bipartite graph. There exists a SIM-BM, iff |N(P )|+ |N(PS) ∩ N(PT )| ≥ |P | for P ⊆ A.\nProof. We prove SIM-HC by induction on |A|. When |A| = 1, the statement holds. Let |A| = k > 1.\nIf AS = ∅ or AT = ∅ then SIM-HC reduces to the condition of Hall’s theorem and the statement is true for that reason. Hence, we assume AS 6= ∅ and AT 6= ∅. We show that there is an edge (u, v) that can be chosen for a simultaneous matching and the graph G′(u,v) will satisfy SIM-HC. Following (Diestel 2006), page 37, we consider two cases. The first case when all subsets of A satisfy the strict SIM-HC, namely, |N(P )|+ |N(PS)∩N(PT )| > |P | and the second case when we have an equality.\nCase 1. Suppose |N(P )| + |N(PS) ∩ N(PT )| > |P | for all sets P ⊂ A. As AS 6= ∅ we select any edge (u, v), u ∈ AS and construct the graph G′(u,v) (the case u ∈ AT is symmetric). For any set P ⊂ A \\ {u} we consider two cases: either v /∈ N(P ) or v ∈ N(P ). In the first case, the neighborhood of P is the same in G and G′, so the SIM-HC holds for P . In the case that v ∈ N(P ), then either v is a shared neighbor of PS and PT , which means that N ′(PS) ∩ N ′(PT ) = N(PS) ∩ N(PT ) − 1 but N ′(P ) = N(P ) by construction, or v is a neighbor of PS but not of PT . Therefore N ′(P ) ≥ N(P ) − 1. But N ′(PS) ∩ N ′(PT ) = N(PS) ∩ N(PT ) by construction. In either case, |N ′(P )| + |N ′(PS) ∩ N ′(PT )| ≥ |N(P )| + |N(PS) ∩ N(PT )| − 1 ≥ |P | for any set P in G′. By the inductive hypothesis there exists a simultaneous matching in it.\nCase 2. Suppose that there exists a set P ( A such that |N(P )|+ |N(PS)∩N(PT )| = |P |. Let Q = 〈A′ ∪B′, E′〉 such that A′ = A \\ P , B′ = B \\ (N(PS) ∩N(PT )) and\nE′ = {(u, v) ∈ E ∩ (A′ ×B′) |\n(u ∈ AS ′ =⇒ v /∈ N(P ) \\N(PT )) ∧\n(u ∈ AT ′ =⇒ v /∈ N(P ) \\N(PS)) ∧\n(u ∈ AST ′ =⇒ v /∈ N(P )) } There exists a simultaneous matching in G − Q by the inductive hypothesis. We claim that the SIM-HC holds also for Q. This implies that, by the inductive hypothesis, there exists a simultaneous matching in Q. Suppose there exists a set P ′ ⊆ A′ that violates the SIM-HC in Q.\nWe denote as N(P ) the neighborhood of P in G and NQ(P\n′) as the neighborhood of P ′ in Q. We know that the sets P ′ and P are disjoint. We observe that N(P ∪\nP ′) = N(P ) ∪ N(P ′) = N(P ) ∪ NQ(P ′), because (N(P ′) \\NQ(P ′)) ⊆ N(P ) by construction of Q. Moreover |N(P ) ∪NQ(P ′)| = |N(P )| + |NQ(P ′)| − |N(P ) ∩ NQ(P ′)| = |N(P )| + |NQ(P ′)| − |N(P ) ∩ (NQ(PS ′ ) ∪ NQ(P T ′) ∪ NQ(PST ′ ))|. By construction of Q, we have that NQ(PST ′ ) ∩ N(P ) = ∅, NQ(PS ′ ) ∩ N(P ) = NQ(P S ′) ∩N(PT ) and NQ(PT ′ ) ∩N(P ) = NQ(PT ′ ) ∩ N(PS). Hence, |N(P )∪NQ(P ′)| = |N(P )|+ |NQ(P ′)|− |D|, where D = (N(PS) ∩ NQ(PT ′ )) ∪ (N(PT ) ∩ NQ(P S ′)). Similarly, N(PS ∪PS ′) = N(PS)∪NQ(PS ′ ) and N(PT ∪ PT ′) = N(PT ) ∪ NQ(PT ′ ). Therefore, |N(PS ∪PS ′)∩N(PT ∪PT ′)| = |(N(PS)∪NQ(PS ′ ))∩ (N(PT )∪NQ(PT ′ ))| ≤ |N(PS)∩N(PT )|+ |NQ(PS ′ )∩ NQ(P T ′)|+ |D|. Finally, we have that\n|N(P ∪ P ′)|+ |N(PS ∪ PS ′) ∩N(PT ∪ PT ′)| ≤ |N(P )|+ |NQ(P ′)| − |D| +\n|N(PS) ∩N(PT )|+ |NQ(PS ′ ) ∩NQ(PT ′ )|+ |D| =\n|N(P )|+ |N(PS) ∩N(PT )| +\n|NQ(P ′)|+ |NQ(PS ′ ) ∩NQ(PT ′| < |P |+ |P ′| = |P ∪ P ′|.\nHence P ∪ P ′ violates the SIM-HC in G, a contradiction. Therefore, there exists a simultaneous matching in Q.\nLet M be a simultaneous matching in Q. For any edge (u, v) ∈ M , we construct the graph R = (G − Q)(u,v) and show that NR(P ∗) = NG(P ∗) and NR(PS ∗ ) ∩ NR(P T ∗) = N(PS ∗ ) ∩N(PT ∗) for any P ∗ ⊆ P .\nLet (u, v) be an edge in M . By construction of Q, we have that v /∈ N(PS∗) ∩N(PT ∗). Hence, the construction of R leaves the size of NR(PS ∗ ) ∩ NR(PT ∗ ) the same as in G. Moreover, u ∈ AST ′ ⇒ v /∈ N(P ∗), u ∈ AS ′ ⇒ v /∈ N(PS ∗ ), u ∈ AT ′ ⇒ v /∈ N(PT ∗).\nConsider the remaining options for the edge (u, v). If u ∈ AS ′ (u ∈ AT ′ is similar) then v can be in N(PT ∗), so v is a shared vertex with N(P ∗). There are two cases to consider: v ∈ N(PT ∗) \\ N(PST ∗) and v ∈ N(PT ∗) ∩ N(PST ∗ ). In the first case, the construction of R leaves the size of NR(PT ∗ ) the same as N(PT ∗) because u ∈ AS ′ and can share vertices with PT ∗. In the latter case, NR(P ST ∗) = N(PST ∗ ) \\ {v}, but NR(PT ∗ ) = N(PT ∗ ). Hence, NR(P ∗) = N(P ∗) in both cases. Therefore, the SIM-HC holds for any P ∗ ⊆ P .\nRunning example. In our running example A = [X1, X2, X3, X4, X5, X6, X7], AS = [X1, X2], AST = [X3, X4, X5] and AT = [X6, X7] . It is easy to check that the simultaneous Hall condition holds for all subsets of the partition A.\nNote that Theorem 2 does not give a polynomial time method to decide if a simultaneous matching exists. Verifying that SIM-HC holds requires checking the exponential number of subsets of A."
    }, {
      "heading" : "Removing edges",
      "text" : "To build a propagator, we consider how to detect edges that cannot appear in any simultaneous matching. Definition 5. Let G = 〈A ∪B,E〉 and sets S, T be an overlapping bipartite graph. A set P , P ⊆ A, is\na simultaneous Hall set iff |N(P )|+ |N(PS) ∩N(PT )| = |P |.\nan almost simultaneous Hall set iff |N(P )|+ |N(PS) ∩N(PT )| = |P |+ 1.\na loose set iff |N(P )|+ |N(PS) ∩N(PT )| ≥ |P |+ 2.\nTheorem 3. G = 〈A ∪B,E〉 and sets S, T be an overlapping bipartite graph. Each edge (u, v), u ∈ A and v ∈ B can be extended to a matching that covers S and T iff\n1. for each set P : (a) |N(P )|+ |N(PS) ∩N(PT )| ≥ |P |\n2. for each simultaneous Hall set P : (a) if u /∈ P then v /∈ (N(PS) ∩N(PT )) (b) if u ∈ S \\ (T ∪ P ) then v /∈ ( N(P ) \\N(PT ) ) (c) if u ∈ T \\ (S ∪ P ) then v /∈ ( N(P ) \\N(PS)\n) (d) if u ∈ (S ∩ T ) \\ P then v /∈ N(P )\n3. for each almost simultaneous Hall set P : (a) if u ∈ (S ∩ T ) \\ P then v /∈ N(PS) ∩N(PT )\nProof. Soundness. The soundness of Rule 1a follows from Theorem 2. Let (u, v) be an edge that we want to extend to a matching. Suppose that (u, v) violates one of the rules for a SIM-HALLSET or an A-SIM-HALLSET P in G. We show that if (u, v) is selected to be in a matching, then P fails SIM-HC in G′(u,v).\nRule 2a: If (u, v) violates Rule 2a for a SIM-HALLSET P then |N ′(PS) ∩N ′(PT )| = |N(PS) ∩N(PT )| − 1 and N ′(P ) = N(P ), so the SIM-HC is violated for P in G′.\nRule 2b: If (u, v) violates Rule 2b for a SIM-HALLSET P then |N ′(P )| = |N(P )| − 1 and |N ′(PS) ∩N ′(PT )| = |N(PS) ∩N(PT )| so the SIM-HC is violated for P in G′.\nRule 2c: Symmetric to Rule 2b. Rule 2d: If (u, v) violates Rule 2d for a SIM-HALLSET P then |N ′(P )| = |N(P )| − 1 so the SIM-HC is violated for P in G′.\nRule 3a: If (u, v) violates Rule 3a for an A-SIM-HALLSET P then |N ′(P )| = |N(P )| − 1 and |N ′(PS) ∩ N ′(PT )| = |N(PS) ∩ N(PT )| − 1, so |N ′(P )|+ |N ′(PS)∩N ′(PT )| = |P | − 1 and the SIM-HC is violated for P in G′.\nCompleteness. Second, we show that Rules 2a- 3a are complete. We will show that we can use any edge (u, v) in a maching by showing that the graph G′(u,v) satisfies the SIM-HC, thus has a SIM-BM.\nSuppose there is a set P that violates the SIM-HC in G′ but not in G so that\n|N ′(P )|+ |N ′(PS) ∩N ′(PT )| < |P | (1)\nand |N(P )|+ |N(PS) ∩N(PT )| ≥ |P | (2)\nNote that N ′(P ) = N(P )\\{v} and N ′(PS)∩N ′(PT ) = N(PS)∩N(PT )\\{v}. Hence, |N ′(P )| ≥ |N(P )|−1 and |N ′(PS) ∩N ′(PT )| ≥ |N(PS) ∩N(PT )| − 1.\nThere are three cases to consider for P in G, when P is a loose set, a SIM-HALLSET and an A-SIM-HALLSET in G. These cases are similar, so we consider only the most difficult case. Let P be an A-SIM-HALLSET in G. If u ∈ AST then v /∈ N(PS) ∩ N(PT ) by Rule 3a. Hence N ′(PS) ∩ N ′(PT ) = N(PS) ∩ N(PT ), so |N ′(P )| + |N ′(PS)∩N ′(PT )| ≥ |N(P )|+ |N(PS)∩N(PT )|−1 ≥ |P | and therefore (1) and (2) cannot both be true.\nIf u ∈ AS (u ∈ AT is symmetric) then v ∈ N(PS) ∩ N(PT ) or its complement. In the first case N ′(P ) = N(P ), while in the second N ′(PS) ∩ N ′(PT ) = N(P ′S) ∩ N(P ′T ). In both cases, |N ′(P )| + |N ′(PS) ∩ N ′(PT )| ≥ |N(P )|+|N(PS)∩N(PT )|−1 ≥ |P | so (1) and (2) cannot both be true.\nRunning example. Consider again our running example. We show that Rules 2a-3a remove every edge that can not be extended to a matching. Consider the set P = {X2, X3, X4, X6}. This is a SIM-HALLSET as N(P ) = {1, 2, 3}, N(PS) ∩ N(PT ) = {2} and 4 = |P | = |N(P )| + |N(PS) ∩ N(PT )| = 4. Hence, by Rule 2d we prune 1, 2, 3 from X5 and by Rule 2a we prune 2 from X1 and X7. Now consider the set P = {X2, X3, X6}. This is an A-SIM-HALLSET. By Rule 3a we prune 2 from X4. The set P = {X2, X4, X6} is also an A-SIM-HALLSET and, by Rule 3a, we prune 2 from X3. Next consider the set P = {X3, X4} which is a SIM-HALLSET. By Rules 2b and 2c we prune 1, 3 from X1, X2, X6 and X7. Now, {X1} is a SIM-HALLSET and 4 is pruned from X5 by Rule 2d. Finally, from the simultaneous Hall set {X5}, we prune 5 from X7 using Rule 2c and we are now at the fixpoint.\n1 2 3 4 5\nAS = S \\ T X1 ∗ X2 ∗\nAST = S ∩ T X3 ∗ ∗ X4 ∗ ∗ X5 ∗\nAT = T \\ S X6 ∗ X7 ∗\nThe overlapping ALLDIFFERENT constraint We now uses these results to build a propagator.\nDefinition 6. OVERLAPPINGALLDIFF([X], S, T ) where S ⊆ X , T ⊆ X , S ∪ T = X holds iff ALLDIFFERENT(S) and ALLDIFFERENT(T ) hold simultaneously .\nEnforcing DC on the OVERLAPPINGALLDIFF constraint is NP -hard (Bessiere et al. 2007). We consider instead enforcing just BC. This relaxation is equivalent to the simultaneous matching problem on a bipartite convex variablevalue graph. Our main result is an algorithm that enforces BC on the OVERLAPPINGALLDIFF constraint in O(nd3) time. The algorithm is based on the decomposition of the OVERLAPPINGALLDIFF constraint into a set of arithmetic constraints derived from Rules 2b–3a. It is inspired by a decomposition of ALLDIFFERENT (Bessiere et al. 2009). As\nthere, we introduce Boolean variables ailu, bil to represent whether Xi takes a value in the interval [l, u] and the variables CS , CST and CT to represent bounds on the number of variables from S \\ T , T \\ S and S ∩ T that may take values in the interval [l, u]. We introduce the following set of constraints for 1 ≤ i ≤ n, 1 ≤ l ≤ u ≤ d and u− l < n:\nbil = 1 ⇐⇒ Xi ≤ l (3) ailu = 1 ⇐⇒ (bi(l−1) = 0 ∧ biu = 1) (4)\nCSTlu = ∑\ni∈S∩T ailu (5)\nCSlu = ∑\ni∈S\\T\nailu (6)\nCTlu = ∑\ni∈T\\S\nailu (7)\nCST1u = C ST 1l + C ST (l+1)u (8)\nCSTlu + C S lu ≤ u− l + 1 (9)\nCSTlu + C T lu ≤ u− l + 1 (10)\nWe also introduce a dummy variable CST10 = 0 to simplify the following lemma and theorems. Lemma 1. Consider a sequence of values v1, v2, . . . , vk. Enforcing BC on (8) ensures ub(CST1vk−1) ≤∑\ni:vi<vi+1 ub(CSTvivi+1−1)− ∑ i:vi>vi+1 lb(CSTvi+1vi−1).\nProof. For every i such that vi < vi+1, constraint (8) ensures that ub(CST1vi+1−1) ≤ ub(C ST 1vi−1) + ub(C ST vivi+1−1). For every i such that vi > vi+1 constraint (8) ensures that ub(CST1vi+1−1) ≤ ub(C ST 1vi−1) − lb(C ST vi+1,vi−1). The left side of each inequality can be substituted into the right side of another inequality until one obtains ub(CST1vk−1) ≤∑\ni:vi<vi+1 ub(CSTvivi+1−1)− ∑ i:vi>vi+1 lb(CSTvi+1vi−1).\nTheorem 4. Enforcing BC on (3)-(10) detects bound disentailment of OVERLAPPINGALLDIFF in O(nd2) time but does not enforce BC on OVERLAPPINGALLDIFF.\nProof. First we derive useful upper bounds for the variables CSTlu . Consider a set P and an interval [a, b] such that N(P ) = [a, b]. Let [c1, d1] ∪ . . . ∪ [ck, dk] be a set of intervals that tightly contain variables from PS so that ∀i, [ci, di] ∈ N(PS), [e1, f1] ∪ . . . ∪ [em, fm] be a set of intervals that tightly contain variables from PT so that ∀i, [ei, fi] ∈ N(PT ), and I1 ∪ . . . ∪ Ip are intersection intervals between intervals [ci, di] and [ei, fi], i.e., ∀i, Ii ∈ N(PS) ∩N(PT ).\nWe first remove all intervals [ci, di] ([ei, fi]) that are completely inside an interval [ej , fj ] ([cj , dj ]). For any of these intervals [ci, di] ([ei, fi] is similar) there exists an intersection interval Ij such that Ij = [ci, di]. We denote the set of removed intervals RI . The remaining intervals are {[c1, d1], . . . , [ck′ , dk′ ]}, [e1, f1] . . . , [em′ , fm′ ]} and I1, . . . , Ip′ . For any interval [ci, di], (9) ensures that ub(CSTcidi) ≤ di − ci + 1− lb(C S cidi\n). Similarly for an interval [ei, fi], we have ub(CSTeifi) ≤ fi − ei + 1− lb(C T eifi ).\nWe sort the union of remaining intervals [ci, di] and [ei, fi] by their lower bounds and list them as semiopen intervals [g1, g2), [g3, g4), . . . , [gk′+m′−1, gk′+m′). Using the sequence a, (g1, g2, . . . , gk′+m′ , b + 1, a)x where (.)x indicates a repetition of x times the same sequence, Lemma 1 provides the inequality ub(CST1a−1) ≤ ub(CST1a−1)+x(ub(CSTag1−1)+ub(C ST gk′+m′b\n)+∑k′ i=1 ub(C ST cidi ) + ∑m′ i=1 ub(C ST eifi\n) − lb(CSTa,b )). Substituting the inequalities that we already defined, we obtain ub(CST1a−1) ≤ a − 1 + x(b − a + 1 + ∑k′ i=1 lb(C S cidi\n) −∑m′ i=1 lb(C T eifi ) + ∑p′\ni=1 |Ii| − lb(CSTa,b )). For any removed interval Ij ∈ RI we have (|Ij | −\nlb(CSmin(Ij)max(Ij))) ≥ 0 or (|Ij |− lb(C T min(Ij)max(Ij) )) ≥ 0. We reintegrate all removed intervals into the inequation to get ub(CST1a−1) ≤ a − 1 + x(b − a + 1 −∑k\ni=1 lb(C S cidi\n)− ∑m\ni=1 lb(C T eifi\n) + ∑p\ni=1 |Ii| − lb(CSTab )). Note that ∑p i=1 |Ii| = |N(PS) ∩ N(PT )|, lb(CSab) =∑k\ni=1 lb(C S cidi ) and lb(CTab) = ∑m i=1 lb(C T eifi ). Hence\nub(CST1a−1) ≤ a− 1 + x(b− a+ 1− lb(CSab)− lb(CTab) +|N(PS) ∩N(PT )| − lb(CSTab )) (*)\nBound disentailment. Suppose, for the purpose of contradiction, that OVERLAPPINGALLDIFF is bound disentailed and that constraints (3)-(10) are bound consistent. Then, there exists a set P , such that N(P ) is an interval and |N(P )|+ |N(PS)∩N(PT )| < |P |. As P fails SIM-HC, it holds that lb(CSTab )+ lb(C S ab)+ lb(C T ab) ≥ |P | > |N(P )|+ |N(PS) ∩ N(PT )| = b − a + 1 + |N(PS) ∩ N(PT )| or lb(CSTab ) ≥ b−a+2−lb(CSab)−lb(CTab)+|N(PS)∩N(PT )|. Substituing the last inequality in (*) gives ub(CST1a−1) ≤ a − 1 − x. Choosing a large enough value for x (say a) gives the contradiction ub(CST1a−1) < 0.\nBound consistency. To show that this decomposition does not enforce BC, consider the conjunction of ALLDIFFERENT ([X1, X2, X3]) and ALLDIFFERENT ([X2, X3, X4]) with D(X1) = [2, 3], D(X2) = [2, 4], D(X3) = [1, 3], D(X4) = [1, 2]. Enforcing BC on (3)-(10) does not remove the bound inconsistent value X2 = 2.\nComplexity. There are O(nd) constraints (3) that can be invoked O(d) times at most. There are O(nd2) constraints (4) that can be invoked O(1) times. There are O(d2) constraints (8) that can be invoked O(n) times. There are O(d2) constraints (5)– (7) that can be propagated in O(n). The remaining constraints take O(nd2) to propagate. The total time complexity is O(nd2).\nIt follows immediately that the simultaneous matching problem is polynomial on bipartite convex graphs. Theorem 5. A simultaneous matching can be found in polynomial time on an overlapping convex bipartite graph.\nNext, we present an algorithm to enforce BC. We show that constraints (3)–(10) together with the following two constraints enforce all but one of the rules from Theorem 3.\nCT1u = C T 1l + C T (l+1)u 1 ≤ l ≤ u ≤ d (11)\nCS1u = C S 1l + C S (l+1)u 1 ≤ l ≤ u ≤ d (12)\nTheorem 6. Constraints (3)-(12) enforce Rules 2a– 2d.\nProof Sketch. Based on Lemma 1, similar to the proof of Theorem 4, we show that all intervals that contain variables from a SIM-HALLSET P become saturated intervals, so that the lower bounds of the corresponding variables CST , CS and CT equal to their upper bounds. Hence, these values are pruned from domains of variables outside the set P .\nTheorem 7. Suppose constraints (3)-(12) together with CSTlu = C ST lk + C ST (k+1)u, 2 ≤ l ≤ k ≤ u ≤ d have reached their fixpoint. Rule 3a can now be enforced in O(nd3) time.\nProof Sketch. Let P is an A-SIM-HALLSET, N(P ) = [a, b]. Similar to the proof of Theorem 4, we can obtain that lb(CSTab ) + 1 ≥ ub(CSTab ). Hence, we can identify intervals, that might contain an A-SIM-HALLSET P . Next, we observe that if we add a dummy variable Z, D(Z) = [a, b] to the set P so that P ′ = P ∪ {Z}, Z ∈ PST ′ then P ′ is a SIM-HALLSET. This allows us to identify the set N(PS) ∩ N(PT ) by simulating constraints (3)-(12) inside the interval [a, b] taking into account the variable Z. There are O(d2) intervals. Finding N(PS) ∩N(PT ) takes O(n+ d) time inside an interval. Enforcing the rule takes O(nd) time. Hence, the total time complexity is O(nd3).\nFrom Theorems 6 and 7 it follows that\nTheorem 8. BC on OVERLAPPINGALLDIFF can be enforced in O(nd3) time.\nRunning example. We demonstrate the action of constraints (3)-(12). The interval [1, 4] contains a SIM-HALLSET P = {X2, X3, X4, X6}. Rule 2d. lb(CS12) ≥ 1 and lb(CT23) ≥ 1⇒ (9), (10)⇒ ub(CST12 ) ≤ 1 and ub(CST23 ) ≤ 1 ⇒ (8) ⇒ ub(CST13 ) ≤ 2. The interval [1, 3] is saturated, as lb(CST13 ) = ub(C ST 13 ). Hence, by (3)-(5), [1, 3] is removed from D(X5). Rules 2b,2c. As lb(CST13 ) = 2 ⇒ (9) ⇒ ub(CS13) ≤ 1 ⇒ (12) ⇒ ub(CS12) ≤ 1. The interval [1, 2] is saturated, as lb(CS12) = ub(C ST 12 ). Hence, by (3)-(4),(6), [1, 2] is removed from D(X1). Similarly, [2, 3] is removed from D(X7). Rule 2a. This is satisfied as 2 is removed from all variables outside P ."
    }, {
      "heading" : "Exponential separation",
      "text" : "We now give a pathological problem on which our new propagator does exponentially less work than existing methods.\nTheorem 9. There exists a class of problems such that enforcing BC on OVERLAPPINGALLDIFF immediately detects unsatisfiability while a search method that enforces DC on the decomposition into ALLDIFFERENT constraints explores an exponential search tree regardless of branching.\nProof. The instance In is defined as follows In = ALLDIFFERENT([X ∪ Y ]) ∧ ALLDIFFERENT([Y ∪ Z]), D(Xi) = [1, 2n − 1], i = 1, . . . , n, D(Yi) = [1, 4n − 1], i = 1, . . . , 2n and D(Zi) = [2n, 4n− 1], i = 1, . . . , n.\nOVERLAPPINGALLDIFF. Consider the interval [1, 4n − 1]. |P | = 4n, |N(P )| = 4n−1 and |N(PS)∩N(PT )| = 0. By Theorem 2, we detect unsatisfiability.\nDecomposition. Consider any ALLDIFFERENT constraint. A subset of n or fewer variables has at least 2n − 1 values in their domains and a subset of n+1 to 3n variables has 4n−1 values in their domains. Thus, to obtain a Hall set and prune, we must instantiate at least n− 1 variables."
    }, {
      "heading" : "Experimental results",
      "text" : "To evaluate the performance of our decomposition we carried out an experiment on random problems. We used Ilog 6.2 on an Intel Xeon 4 CPU, 2.0 GHz, 4GB RAM. We compare the performance of the DC, BC (LopezOrtiz et al. 2003) propagators and our decomposition into constraints (3)-(12) for the OVERLAPPINGALLDIFF constraint (OBC). We use randomly generated problems with three global constraints: ALLDIFFERENT(X ∪ W ), ALLDIFFERENT(Y ∪W ) and ALLDIFFERENT(Z∪W ), and a linear number of binary ordering relations between variables in X , Y and Z. We use a random variable ordering and run each instance with 50 different seeds. As Table 1 shows, our decomposition reduces the search space significantly, is much faster and solves more instances overall."
    }, {
      "heading" : "Conclusions",
      "text" : "We have generalized Hall’s theorem to simultaneous matchings in a bipartite graph. This generalization suggests a polynomial time algorithm to find a simultaneous matching in a convex bipartite graph. We applied this to a problem in constraint programming of propagating conjunctions of ALLDIFFERENT constraints. Initial experimental results suggest that reasoning about such conjunctions can significantly reduce the size of the explored search space. There are several avenues for future research. For example, the algorithmic techniques proposed in (Puget 1998) and (LopezOrtiz et al. 2003) may be generalizable to simultaneous bipartite matchings, giving more efficient propagators. Further, matchings are used to propagate other constraints such\nas NVALUE (Bessiere et al. 2006). It may be possible to apply similar insights to develop propagators for conjunctions of other global constraints, or to improve existing propagators for global constraints that decompose into overlapping constraints like SEQUENCE (Brand et al. 2005). Finally, we may be able to develop polynomial time propagators for otherwise intractable cases if certain parameters are fixed (Bessiere et al. 2008)."
    }, {
      "heading" : "Acknowledgments",
      "text" : "This research is supported by ANR UNLOC project (ANR 08-BLAN-0289-01), the Australian Government’s Department of Broadband, Communications and the Digital Economy and the ARC."
    } ],
    "references" : [ {
      "title" : "Filtering algorithms for the NVALUE",
      "author" : [ "Bessiere" ],
      "venue" : "constraint. Constraints,",
      "citeRegEx" : "Bessiere,? \\Q2006\\E",
      "shortCiteRegEx" : "Bessiere",
      "year" : 2006
    }, {
      "title" : "The Parameterized Complexity of Global Constraints",
      "author" : [ "Bessiere" ],
      "venue" : "In Proc. of 23rd AAAI,",
      "citeRegEx" : "Bessiere,? \\Q2008\\E",
      "shortCiteRegEx" : "Bessiere",
      "year" : 2008
    }, {
      "title" : "Decompositions of all different, global cardinality and related constraint",
      "author" : [ "Bessiere" ],
      "venue" : "In Proc. of 21st IJCAI,",
      "citeRegEx" : "Bessiere,? \\Q2009\\E",
      "shortCiteRegEx" : "Bessiere",
      "year" : 2009
    }, {
      "title" : "Encodings of the Sequence Constraint",
      "author" : [ "Brand" ],
      "venue" : "In Proc. of CP-2007,",
      "citeRegEx" : "Brand,? \\Q2007\\E",
      "shortCiteRegEx" : "Brand",
      "year" : 2007
    }, {
      "title" : "Simultaneous matchings: Hardness and approximation",
      "author" : [ "Kutz" ],
      "venue" : "J. of Computer and System Sciences",
      "citeRegEx" : "Kutz,? \\Q2008\\E",
      "shortCiteRegEx" : "Kutz",
      "year" : 2008
    }, {
      "title" : "Interleaved Alldifferent Constraints: CSP vs. SAT Approaches",
      "author" : [ "Lardeux" ],
      "venue" : "In Proc. of AIMSA,",
      "citeRegEx" : "Lardeux,? \\Q2008\\E",
      "shortCiteRegEx" : "Lardeux",
      "year" : 2008
    }, {
      "title" : "A fast and simple algorithm for bounds consistency of the alldifferent constraint",
      "author" : [ "Lopez-Ortiz" ],
      "venue" : "Proc. of 18th IJCAI,",
      "citeRegEx" : "Lopez.Ortiz,? \\Q2003\\E",
      "shortCiteRegEx" : "Lopez.Ortiz",
      "year" : 2003
    }, {
      "title" : "The difference all-difference makes",
      "author" : [ "Stergiou", "K. Walsh 1999] Stergiou", "T. Walsh" ],
      "venue" : "In Proc. of 16th IJCAI,",
      "citeRegEx" : "Stergiou et al\\.,? \\Q1999\\E",
      "shortCiteRegEx" : "Stergiou et al\\.",
      "year" : 1999
    } ],
    "referenceMentions" : [ ],
    "year" : 2013,
    "abstractText" : "We study propagation algorithms for the conjunction of two ALLDIFFERENT constraints. Solutions of an ALLDIFFERENT constraint can be seen as perfect matchings on the variable/value bipartite graph. Therefore, we investigate the problem of finding simultaneous bipartite matchings. We present an extension of the famous Hall theorem which characterizes when simultaneous bipartite matchings exists. Unfortunately, finding such matchings is NP-hard in general. However, we prove a surprising result that finding a simultaneous matching on a convex bipartite graph takes just polynomial time. Based on this theoretical result, we provide the first polynomial time bound consistency algorithm for the conjunction of two ALLDIFFERENT constraints. We identify a pathological problem on which this propagator is exponentially faster compared to existing propagators. Our experiments show that this new propagator can offer significant benefits over existing methods.",
    "creator" : "LaTeX with hyperref package"
  }
}